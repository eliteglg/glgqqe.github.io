<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Storage</title>
  <style>
    :root {
      color-scheme: dark;
    }
    body {
      font-family: sans-serif;
      padding: 1em;
      background: #121212;
      color: #e0e0e0;
    }
    a {
      color: #80d0ff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    ul {
      list-style-type: none;
      padding-left: 1.5em;
      margin: 0;
    }
    li {
      margin: 4px 0;
      line-height: 1.6;
    }
    .folder {
      font-weight: bold;
      cursor: pointer;
    }
    .collapsed > ul {
      display: none;
    }
    .toggle {
      user-select: none;
      margin-right: 6px;
      font-size: 14px;
    }
    .zip-link {
      font-weight: normal;
      font-size: 0.85em;
      margin-left: 8px;
      opacity: 0.7;
    }
    .zip-link:hover {
      opacity: 1;
    }
    .download-all {
      margin-top: 20px;
      display: inline-block;
      padding: 10px 15px;
      background: #2a72bb;
      color: white;
      text-decoration: none;
      border-radius: 6px;
    }
    h1 {
      margin-bottom: 0.5em;
    }
    .error {
      color: #ff6f6f;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>üìÅ –§–∞–π–ª—ã</h1>
  <div id="tree">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <script>
    // –ü—É—Å—Ç—å –∑–¥–µ—Å—å –ø—É—Ç—å –∫ JSON —Å –ø—Ä–µ–¥—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
    // –ü—Ä–∏–º–µ—Ä: https://glgqqe.github.io/files/tree.json
    const treeJsonPath = 'files/tree.json';

    // –ü–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏
    const basePath = 'files';

    // –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ ZIP-–ø–∞–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Google Drive)
    const externalZipLinks = {
      "bftv": "https://drive.google.com/file/d/1VmgPHeObfoV0EBH8VfoO3fzSlwm70ua8/view?usp=sharing"
      "apfs": "https://drive.google.com/file/d/1lVDyocXUdG0wZP_Y1_A7RB-0sJ6YWxhR/view?usp=drive_link"
      "dora": "https://drive.google.com/file/d/1vNqAey-kVSchAZQI3CrNnJK7wQC5srpK/view?usp=drive_link"
    };

    const treeContainer = document.getElementById('tree');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è HTML –∏–∑ –¥–µ—Ä–µ–≤–∞ (—Ñ–æ—Ä–º–∞—Ç tree.json –Ω–∏–∂–µ)
    function renderTree(node, prefix = '') {
      let html = '<ul>';
      node.forEach(item => {
        const fullPath = prefix ? `${prefix}/${item.name}` : item.name;
        if(item.type === 'folder'){
          const zipHref = externalZipLinks[fullPath] || `files/zips/${fullPath}.zip`;
          const zipLink = `<a class="zip-link" href="${zipHref}" target="_blank" rel="noopener">[ZIP]</a>`;
          html += `
            <li class="folder collapsed">
              <span class="toggle">‚ñ∂</span><span class="folder-name">${item.name}</span> ${zipLink}
              ${renderTree(item.children, fullPath)}
            </li>
          `;
        } else if(item.type === 'file'){
          const url = `${basePath}/${fullPath}`;
          html += `<li>üìÑ <a href="${url}" download>${item.name}</a></li>`;
        }
      });
      html += '</ul>';
      return html;
    }

    function enableFolderToggle(){
      const folders = document.querySelectorAll('.folder');
      folders.forEach(folder => {
        const toggle = folder.querySelector('.toggle');
        const name = folder.querySelector('.folder-name');
        const toggleFunc = () => {
          folder.classList.toggle('collapsed');
          toggle.textContent = folder.classList.contains('collapsed') ? '‚ñ∂' : '‚ñº';
        };
        toggle.addEventListener('click', toggleFunc);
        name.addEventListener('click', toggleFunc);
      });
    }

    async function loadTree() {
      try {
        const res = await fetch(treeJsonPath);
        if(!res.ok) throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${treeJsonPath}: ${res.status}`);
        const data = await res.json();
        treeContainer.innerHTML = renderTree(data);
        enableFolderToggle();
      } catch(err){
        treeContainer.innerHTML = `<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤:<br>${err.message}</p>`;
      }
    }

    loadTree();
  </script>
</body>
</html>
